asyncapi: '2.2.0'

#
# Overal information for users of the application
#
info:
  title: Arduino server
  version: '1.0.0'
  contact:
    name: MAKinteract
    url: https://makinteract.kaist.ac.kr
  description: Remotely control an Arduino

#
# Details on how to connect to the application
#
servers:
  public:
    url: http://localhost:3000
    protocol: wss

channels:
  listSerials:
    publish:
      message:
        $ref: '#/components/messages/listSerials'
  listSerialsData:
    subscribe:
      message:
        $ref: '#/components/messages/listSerialsData'

  beginSerial:
    publish:
      message:
        $ref: '#/components/messages/beginSerial'
  connectSerial:
    publish:
      message:
        $ref: '#/components/messages/connectSerial'
  disconnectSerial:
    publish:
      message:
        $ref: '#/components/messages/disconnectSerial'
  compileAndUpload:
    publish:
      message:
        $ref: '#/components/messages/compileAndUpload'

  serialData:
    subscribe:
      message:
        $ref: '#/components/messages/serialData'
  info:
    subscribe:
      message:
        $ref: '#/components/messages/info'
  error:
    subscribe:
      message:
        $ref: '#/components/messages/error'

components:
  messages:
    listSerials:
      payload:
        additionalProperties: false
    listSerialsData:
      payload:
        type: array
        additionalProperties: false
        items:
          type: string
        example: ['COM1', 'COM2', 'COM3']
    connectSerial:
      payload:
        additionalProperties: false
    disconnectSerial:
      payload:
        additionalProperties: false
    beginSerial:
      payload:
        type: object
        additionalProperties: false
        properties:
          port:
            type: string
            example: 'COM1'
          baud:
            type: number
            example: 115200
          autoconnect:
            type: boolean
            example: true
    compileAndUpload:
      payload:
        type: object
        additionalProperties: false
        properties:
          sketchPath:
            type: string
            example: '/path/to/arduino_sketch'
          autoconnect:
            type: boolean
            example: true

    serialData:
      payload:
        type: string
        additionalProperties: false
        example: 'Some data'
    info:
      payload:
        type: object
        additionalProperties: false
        properties:
          msg:
            type: string
            example: 'Some info message'
    error:
      payload:
        type: object
        additionalProperties: false
        properties:
          msg:
            type: string
            example: 'Some error message'
